<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Doppler Shift Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #simulationCanvas {
            border: 1px solid #000;
            margin: 20px auto;
            display: block;
        }
        #results {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Scenario 1: Instantaneous Doppler Shift Simulation</h1>
    <div>
        <label for="frequency">Frequency (MHz):</label>
        <input id="frequency" type="number" value="100"><br>
        <label for="velocity">Receiver Velocity (m/s):</label>
        <input id="velocity" type="number" value="10"><br>
        <label for="initialDistance">Initial Distance (m):</label>
        <input id="initialDistance" type="number" value="300"><br>
        <button onclick="startScenario1()">Start</button>
        <button onclick="resetScenario1()">Reset</button>
    </div>
    <canvas id="simulationCanvas" width="800" height="400"></canvas>
    <div id="results">Instantaneous Doppler Shift: - Hz</div>

    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const resultsDiv = document.getElementById('results');

        const transmitter = { x: 100, y: 200, img: new Image() };
        const receiver = { x: 400, y: 200, velocity: 0, img: new Image(), direction: 1, initialDistance: 300 };

        let animationFrame;
        let frequency = 100e6; // Default frequency in Hz (100 MHz)

        transmitter.img.onload = () => {
            if (transmitter.img.complete && receiver.img.complete) {
                draw();
            }
        };

        receiver.img.onload = () => {
            if (transmitter.img.complete && receiver.img.complete) {
                draw();
            }
        };

        transmitter.img.src = './static/images/antenna-svgrepo-com.svg';
        receiver.img.src = './static/images/car.svg';

        function calculateInstantaneousDopplerShift() {
            const c = 3e8; // Speed of light (m/s)
            const dx = receiver.x - transmitter.x; // Horizontal distance
            const dy = receiver.y - transmitter.y; // Vertical distance (remains constant in this case)
            const instantaneousDistance = Math.sqrt(dx ** 2 + dy ** 2); // Pythagoras theorem
            const relativeVelocity = receiver.velocity * receiver.direction; // Velocity component along the direction of movement
            const instantaneousDopplerShift = -(frequency * relativeVelocity) / instantaneousDistance;
            return instantaneousDopplerShift;
        }

        function startScenario1() {
            frequency = parseFloat(document.getElementById('frequency').value) * 1e6; // Frequency in Hz
            receiver.velocity = parseFloat(document.getElementById('velocity').value); // Receiver velocity
            receiver.initialDistance = parseFloat(document.getElementById('initialDistance').value); // Initial distance
            receiver.x = transmitter.x + receiver.initialDistance; // Set receiver's starting position based on initial distance
            receiver.direction = 1; // Start moving to the right
            animateScenario1();
        }

        function animateScenario1() {
            const margin = 50; // Margin from the canvas edges

            // Update receiver position
            receiver.x += receiver.velocity * receiver.direction * 0.1; // Velocity scaled for animation

            // Reverse direction if the receiver hits canvas edges
            if (receiver.x < margin) {
                receiver.x = margin;
                receiver.direction *= -1;
            }
            if (receiver.x > canvas.width - margin) {
                receiver.x = canvas.width - margin;
                receiver.direction *= -1;
            }

            // Calculate instantaneous Doppler shift
            const dopplerShift = calculateInstantaneousDopplerShift();
            resultsDiv.innerHTML = `Instantaneous Doppler Shift: ${dopplerShift.toFixed(2)} Hz`;

            // Draw updated frame
            draw();

            // Request next animation frame
            animationFrame = requestAnimationFrame(animateScenario1);
        }

        function resetScenario1() {
            cancelAnimationFrame(animationFrame); // Stop animation
            receiver.x = transmitter.x + receiver.initialDistance; // Reset position
            receiver.velocity = 0; // Reset velocity
            resultsDiv.innerHTML = 'Instantaneous Doppler Shift: - Hz'; // Clear results
            draw(); // Redraw static frame
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw transmitter
            ctx.drawImage(transmitter.img, transmitter.x - 40, transmitter.y - 40, 80, 80);
            ctx.fillText("Transmitter", transmitter.x - 40, transmitter.y - 50);

            // Draw receiver
            ctx.drawImage(receiver.img, receiver.x - 30, receiver.y - 30, 60, 60);
            ctx.fillText("Receiver", receiver.x - 30, receiver.y - 50);

            // Draw signal line
            ctx.strokeStyle = 'orange';
            ctx.beginPath();
            ctx.moveTo(transmitter.x, transmitter.y);
            ctx.lineTo(receiver.x, receiver.y);
            ctx.stroke();
        }

        // Initial draw
        draw();
    </script>
</body>
</html>
