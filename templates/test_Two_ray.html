<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Doppler Shift Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #simulationCanvas {
            border: 1px solid #000;
            margin: 20px auto;
            display: block;
        }
        #results {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Scenario 1: Instantaneous Doppler Shift Simulation</h1>
    <div>
        <label for="frequency">Frequency (MHz):</label>
        <input id="frequency" type="number" value="100"><br>
        <label for="velocity">Receiver Velocity (m/s):</label>
        <input id="velocity" type="number" value="10"><br>
        <label for="initialDistance">Initial Distance (m):</label>
        <input id="initialDistance" type="number" value="300"><br>
        <button onclick="startScenario1()">Start</button>
        <button onclick="resetScenario1()">Reset</button>
    </div>
    <canvas id="simulationCanvas" width="800" height="400"></canvas>
    <div id="results">Instantaneous Doppler Shift: - Hz</div>

    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const resultsDiv = document.getElementById('results');

        const transmitter = { x: 100, y: 200, img: new Image() };
        const receiver = { x: 400, y: 200, velocity: 0, img: new Image(), direction: 1, initialDistance: 300 };

        let animationFrame;
        let frequency = 100e6; // Default frequency in Hz (100 MHz)
        const c = 3e8; // Speed of light (m/s)

        transmitter.img.onload = () => {
            if (transmitter.img.complete && receiver.img.complete) {
                draw();
            }
        };

        receiver.img.onload = () => {
            if (transmitter.img.complete && receiver.img.complete) {
                draw();
            }
        };

        transmitter.img.src = './static/images/antenna-svgrepo-com.svg';
        receiver.img.src = './static/images/car.svg';

        function calculateInstantaneousDopplerShift() {
            const dx = receiver.x - transmitter.x;
            const dy = receiver.y - transmitter.y;
            const distance = Math.sqrt(dx ** 2 + dy ** 2);
            
            // Calculate the angle between velocity vector and line of sight
            const cosTheta = dx / distance;
            
            // Calculate radial velocity (velocity component along line of sight)
            const radialVelocity = receiver.velocity * receiver.direction * cosTheta;
            
            // Implement classical Doppler shift formula
            // For radio waves: Δf = f * (v/c) * cos(θ)
            // where f is transmitter frequency, v is relative velocity, 
            // c is speed of light, and θ is angle between velocity and line of sight
            const dopplerShift = frequency * (radialVelocity / c);
            
            // Ensure the shift doesn't exceed maximum possible shift (100 Hz in this case)
            const maxShift = 100; // Maximum allowed shift in Hz
            return Math.max(Math.min(dopplerShift, maxShift), -maxShift);
        }

        function startScenario1() {
            frequency = parseFloat(document.getElementById('frequency').value) * 1e6; // Frequency in Hz
            receiver.velocity = parseFloat(document.getElementById('velocity').value); // Receiver velocity
            receiver.initialDistance = parseFloat(document.getElementById('initialDistance').value); // Initial distance
            receiver.x = transmitter.x + receiver.initialDistance;
            receiver.direction = 1;
            animateScenario1();
        }

        function animateScenario1() {
            const margin = 50;

            receiver.x += receiver.velocity * receiver.direction * 0.1;

            if (receiver.x < margin) {
                receiver.x = margin;
                receiver.direction *= -1;
            }
            if (receiver.x > canvas.width - margin) {
                receiver.x = canvas.width - margin;
                receiver.direction *= -1;
            }

            const dopplerShift = calculateInstantaneousDopplerShift();
            const instantaneousFrequency = (frequency - dopplerShift);
            
            resultsDiv.innerHTML = `
                Maximum Doppler Shift: ${dopplerShift.toFixed(2)} Hz<br>
                Instantaneous Frequency: ${instantaneousFrequency} Hz
            `;

            draw();
            animationFrame = requestAnimationFrame(animateScenario1);
        }

        function resetScenario1() {
            cancelAnimationFrame(animationFrame);
            receiver.x = transmitter.x + receiver.initialDistance;
            receiver.velocity = 0;
            resultsDiv.innerHTML = 'Maximum Doppler Shift: - Hz<br>Instantaneous Frequency: - MHz';
            draw();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw transmitter
            ctx.drawImage(transmitter.img, transmitter.x - 40, transmitter.y - 40, 80, 80);
            ctx.fillText("Transmitter", transmitter.x - 40, transmitter.y - 50);

            // Draw receiver
            ctx.drawImage(receiver.img, receiver.x - 30, receiver.y - 30, 60, 60);
            ctx.fillText("Receiver", receiver.x - 30, receiver.y - 50);

            // Draw signal line
            ctx.strokeStyle = 'orange';
            ctx.beginPath();
            ctx.moveTo(transmitter.x, transmitter.y);
            ctx.lineTo(receiver.x, receiver.y);
            ctx.stroke();
        }

        draw();
    </script>
</body>
</html>
